(()=>{"use strict";const t=class{constructor(t=0,s=0){this.x=t,this.y=s}get len(){return Math.sqrt(this.x*this.x+this.y*this.y)}set len(t){const s=t/this.len;this.x*=s,this.y*=s}};class s{constructor(s=0,e=0){this.pos=new t(0,0),this.size=new t(s,e)}get left(){return this.pos.x-this.size.x/2}get right(){return this.pos.x+this.size.x/2}get top(){return this.pos.y-this.size.y/2}get bottom(){return this.pos.y+this.size.y/2}setLeft(t){this.pos.x=t+this.size.x/2}setRight(t){this.pos.x=t-this.size.x/2}}class e extends s{constructor(){super(10,10),this.vel=new t}}class i extends s{constructor(){super(20,100),this.vel=new t,this.score=0,this._lastPos=new t}update(t){this.vel.y=(this.pos.y-this._lastPos.y)/t,this._lastPos.y=this.pos.y}}class h{constructor(t){this.canvas=t,this.width=this.canvas.width,this.height=this.canvas.height}setDimension(t,s){this.canvas.width=t,this.canvas.height=s,this.width=this.canvas.width,this.height=this.canvas.height}}const l=document.querySelector("#pong"),o=new class{constructor(t){this.world=new h(t),this._canvas=this.world.canvas,this._context=t.getContext("2d"),this.initialSpeed=750,this.AI_SPEED=5.5,this.ball=new e,this.players=[new i,new i],this.players[0].pos.x=40,this.players[1].pos.x=this.world.width-40,this.players.forEach((t=>t.pos.y=this.world.height/2));let s=null;this._frameCallback=t=>{if(null!==s){const e=t-s;this.update(e/1e3)}s=t,requestAnimationFrame(this._frameCallback)},this.CHAR_PIXEL=10,this.CHARS=["111101101101111","010010010010010","111001111100111","111001111001111","101101111001001","111100111001111","111100111101111","111001001001001","111101111101111","111101111001111"].map((t=>{const s=document.createElement("canvas"),e=this.CHAR_PIXEL;s.height=5*e,s.width=3*e;const i=s.getContext("2d");return i.fillStyle="#fff",t.split("").forEach(((t,s)=>{"1"===t&&i.fillRect(s%3*e,(s/3|0)*e,e,e)})),s})),this.reset()}setDimension(t,s){this.world.setDimension(t,s),this.players[1].pos.x=this.world.width-40}clear(){this._context.fillStyle="#002",this._context.fillRect(0,0,this.world.width,this.world.height)}collide(t,s){if(t.left<s.right&&t.right>s.left&&t.top<s.bottom&&t.bottom>s.top){s.vel.x>0?s.setRight(t.left-1):s.setLeft(t.right+1),s.vel.x=1.05*-s.vel.x;const e=s.vel.len;s.vel.y+=.2*t.vel.y,s.vel.len=e}}draw(){this.clear(),this.drawRect(this.ball),this.players.forEach((t=>this.drawRect(t))),this.drawScore()}drawRect(t){this._context.fillStyle="#ccf",this._context.fillRect(t.left,t.top,t.size.x,t.size.y)}drawScore(){const t=this.world.width/3,s=4*this.CHAR_PIXEL;this.players.forEach(((e,i)=>{const h=e.score.toString().split(""),l=t*(i+1)-s*h.length/2+this.CHAR_PIXEL/2;h.forEach(((t,e)=>{this._context.drawImage(this.CHARS[0|t],l+e*s,20)}))}))}play(){const t=this.ball;0===t.vel.x&&0===t.vel.y&&(t.vel.x=200*(Math.random()>.5?1:-1),t.vel.y=200*(2*Math.random()-1),t.vel.len=this.initialSpeed)}reset(){const t=this.ball;t.vel.x=0,t.vel.y=0,t.pos.x=this.world.width/2,t.pos.y=this.world.height/2}start(){requestAnimationFrame(this._frameCallback)}update(t){const s=this.ball;var e,i,h;s.pos.x+=s.vel.x*t,s.pos.y+=s.vel.y*t,(s.right<0||s.left>this.world.width)&&(++this.players[s.vel.x<0|0].score,this.reset()),(s.vel.y<0&&s.top<0||s.vel.y>0&&s.bottom>this.world.height)&&(s.vel.y=-s.vel.y),this.players[1].pos.y=(e=this.players[1].pos.y,i=s.pos.y,e*(1-(h=t*this.AI_SPEED))+i*h),this.players.forEach((e=>{e.update(t),this.collide(e,s)})),this.draw()}}(l);l.addEventListener("click",(()=>o.play())),l.addEventListener("mousemove",(t=>{const s=t.offsetY/t.target.getBoundingClientRect().height;o.players[0].pos.y=l.height*s})),o.start()})();